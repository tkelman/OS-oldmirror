\division{OS Release Procedure}\label{section:ReleaseProcedure} 

\subdivision{Preparing the release}\label{section:ReleasePrep}

There are four scripts in the {\tt BuildTools} directory that help with the release, namely

\begin{verbatim}
prepare_new_stable
commit_new_stable
prepare_new_release
commit_new_release
\end{verbatim}

\medskip

The first of these, {\tt prepare\_new\_stable}, prepares a new stable version. The simplest form of invoking it is

\begin{verbatim}
($BUILDTOOLSDIR)/prepare_new_stable <loc>
\end{verbatim}

where {\tt loc} is the location that forms the basis of the new stable version, e.g., {\tt OS/trunk}.
{\tt prepare\_new\_stable} uses svn to check out the code, but it locates the latest stable versions of all the dependencies instead of the trunk versions.

Some command line options (from comments in the script):

\begin{description}
  \item[\tt -p]			Suppress checkout (useful for testing)
  \item[\tt -m] 		Bump the major version number.
\end{description}

This script will do the following:

\begin{itemize}
  \item Set the new stable version number as the next minor version number in
    the current major version number. Use the -m flag to bump the major
    version number.

  \item Convert externals from trunk to the top stable branch. Externals which
    are currently stable or release are left untouched. Use -t to suppress
    the change from trunk to stable. Set\_externals is then invoked to set
    release externals where available.

  \item Check out externals. The BuildTools version used by externals (if any)
    is checked, and the script issues a warning if it doesn't match the
    version used by the source URL.

 \item Run the scripts to download any ThirdParty code.

  \item Run {\tt run\_autotools} to rebuild configure and make files.

  \item Run configure, make, and make test

  \item Tweak the externals to upgrade trunk  dependencies to stable.
\end{itemize}

If there is any error during these tasks the script will stop and you should
examine the output.
   
\medskip

The script {\tt commit\_new\_stable} commits the new stable revision. It should be run only after 
{\tt prepare\_new\_stable} has been processed correctly.  

The simplest form of invoking it is

\begin{verbatim}
($BUILDTOOLSDIR)/commit_new_stable <loc>
\end{verbatim}

\noindent
where {\tt loc} is the location that forms the basis of the new stable version, e.g., {\tt OS/trunk}. In this form, it only performs a ``dry run'', that is, it only prints the commands that are to be executed, without actually doing anything. Once satisfied, use the command line parameter -c to do the commit.

{\tt prepare\_new\_release} and {\tt commit\_new\_release} are the corresponding scripts to prepare and commit releases (which are based on stable versions).

\subsubdivision{Version numbers}{\label{section:VersionNumbering}

The version number is defined in the file {\tt configure.ac}. There are actually two versions of this file,
in the root directory as well as the top OS directory. Each of them contains a call to {\tt AC\_INIT}, 
in which the second parameter is the version number. Change this number appropriately as follows:
For trunk versions, use {\bf trunk}, so that {\tt OSgetVersionNumber()} can print the correct svn revision number in the header of the output; for stable and release versions use the proper number ({\tt n.n} for stable versions, {\tt n.n.n} for releases).

\subdivision{Release testing}\label{section:ReleaseTesting}

\begin{itemize}

\item[1.] Run the {\bf nightlyBuild.py} script.

\item[2.] Test the examples.  They are in {\bf OS/examples}.  Do a {\bf make install} before running these.

\begin{itemize}

\item[a.]  Connect to the {\bf algorithmicDiff} folder, build and run {\bf OSAlgorithmicDiffTest.cpp}.  This takes no arguments.  This will test a bunch of the AD routines.



\item[b.]  Connect to the {\bf instanceGenerator} folder, build and run {\bf OSInstanceGenerator.cpp}.  This takes no arguments.

\item[c.]  Connect to the {\bf osTestCode} folder, build and run {\bf OSTestCode.cpp}.  This takes a single argument which is the location of any OSiL file.


\end{itemize}

\item[3.] Test the applications.  They are in {\bf OS/applications}.

\begin{itemize}
 
 
 \item[a.]  Test {\bf OSAmplClient}.  This is not a stand-alone application and is designed to be called from  {\bf ampl}.   Probably the easiest way to test this is to test the {\bf OSAmplClient}  that gets installed in the {\bf bin} directory as a result of {\bf make install}. To make life easy, temporarily copy your {\bf ampl} executable into this {\bf bin} directory.   Also copy the test problem {\bf hs71.nl}  from {\bf OS/data/amplFiles/} into the {\bf bin} directory.   Do five tests. Three local and two remote.
 
 
 \vskip 10pt
 
 
 {\bf Test 1:}  Inside  {\bf ampl} execute the following
 


\begin{verbatim}
model hs71.mod;
option solver OSAmplClient;
option OSAmplClient_options "solver xyz";
solve;
\end{verbatim}

The result should be an error saying:
\begin{verbatim}
<message>a supported solver has not been selected</message>
\end{verbatim}
 
 \vskip 10pt
 
 {\bf Test 2:}  Inside  {\bf ampl} execute the following
 


\begin{verbatim}
model hs71.mod;
option solver OSAmplClient;
option OSAmplClient_options "solver ipopt";
solve;
display x1;
\end{verbatim}

The result of {\bf display x3} should be 3.82115. 


 \vskip 10pt
 
 {\bf Test 3:}  Inside  {\bf ampl} execute the following
 


\begin{verbatim}
model hs71.mod;
option solver OSAmplClient;
option OSAmplClient_options "solver cbc";
solve;
\end{verbatim}

You should get an error message saying:
\begin{verbatim}
<message>Cbc cannot do nonlinear or quadratic</message>
\end{verbatim}


\vskip 10pt

{\small
{\bf Test 4:}  Inside  {\bf ampl} execute the following
\begin{verbatim}
model hs71.mod;
option solver OSAmplClient;
option OSAmplClient_options "solver ipopt";
option ipopt_options "service http://74.94.100.129:808/OSServer/Services/OSSolverService";
solve;
display x1;
\end{verbatim}
}%end small

The result of {\bf display x3} should be 3.82115. 


\vskip 10pt

{\small
{\bf Test 5:}  Inside  {\bf ampl} execute the following
\begin{verbatim}
model hs71.mod;
option solver OSAmplClient;
option OSAmplClient_options "solver clp";
option clp_options "service  http://74.94.100.129:808/OSServer/Services/OSSolverService";
solve;
display x3;
\end{verbatim}
}%end small

You should get an error message saying"
\begin{verbatim}
<message>Clp cannot do nonlinear or quadratic or integer</message>
\end{verbatim}



There is command script, {\bf testAmpl.run} in the directory {\bf OS/data/amplFiles} that contains the commands for all of these test. Simply start {\bf ampl} and execute
\begin{verbatim}
include testAmpl.run;
\end{verbatim}



\item[b.] Test the {\bf OSFileUpload} application.    Edit  {\bf OSFileUpload.cpp}. First comment out line 79 and then modify line 
\begin{verbatim}
osagent = new OSSolverAgent("http://******/os/servlet/OSFileUpload");
\end{verbatim}
to
{\small
\begin{verbatim}
osagent = new OSSolverAgent("http://gsbkip.chicagogsb.edu/os/servlet/OSFileUpload");
\end{verbatim}
}
Rebuild and run. This application takes one command line argument which is the file to be uploaded. 

\end{itemize}

\item[4.] Test the {\bf OSSolverService}.

\begin{itemize}
\item[a.] Test running a local solver.  (These examples assume that the {\bf OS/data} directory is one level above the directory  in which {\bf OSSolverService} is running. Test  for OSiL, mps, and nl files.

\begin{verbatim}
OSSolverService -config ../data/configFiles/testLocal.config
OSSolverService -config ../data/configFiles/testLocalMPS.config
OSSolverService -config ../data/configFiles/testLocalNL.config
\end{verbatim}


You should get the OSrL for the simple test problem.   In all of these look for {\tt <obj idx="-1">-7667.94</obj>} in the MPS test and {\tt <obj idx="-1">-7667.94</obj>} in the other two.


\item[b.]  Test the service methods on the remote server.  


\noindent{\bf Step 1:} Test remote {\bf solve()} method for OSiL, mps, and nl files.



\begin{verbatim}
OSSolverService -config ../data/configFiles/testRemote.config
OSSolverService -config ../data/configFiles/testRemoteMPS.config
OSSolverService -config ../data/configFiles/testRemoteNL.config
\end{verbatim}


You should get the OSrL for the simple test problem in each case.  In all of these look for {\tt <obj idx="-1">-7667.94</obj>}.

\vskip 10pt


\noindent{\bf Step 2:} Test remote {\bf getJobID()} method.


\begin{verbatim}
OSSolverService  -config ../data/configFiles/testRemotegetJobID.config
\end{verbatim}



You will get a long jobID.


\vskip 10pt


\noindent{\bf Step 3:} Test remote {\bf send()} method. Use the {\bf send()} method with the jobID just  generated.  To do this open the file
\begin{verbatim}
/data/osolFiles/sendWithJobID.osol
\end{verbatim}
and replace the existing jobID with the one just generated.  Then run
\begin{verbatim}
OSSolverService  -config ../data/configFiles/testRemoteSend.config
\end{verbatim}
The result should be ``send is true.''

\vskip 10pt

\noindent{\bf Step 4:} Test remote {\bf knock()} method.  See if the  job is complete.


\begin{verbatim}
OSSolverService  -config ../data/configFiles/testRemoteKnock.config
\end{verbatim}

You do not need to put in jobID information. The knock will get the status of all jobs. However, if you want just the status of the job you submitted put your jobID in the {\tt knock.osol} file. 

\vskip 10pt

\noindent{\bf Step 5:} Test remote {\bf retrieve()} method. Get the result.

\begin{verbatim}
OSSolverService  -config ../data/configFiles/testRemoteRetrieve.config
\end{verbatim}
Before executing this command make sure to put your jobID into the file {\bf retrieve.osol }.  Also, either delete the {\tt -browser} option or put in the path to your browser.
The result of the optimization will be put into a file called {\bf test.osrl} that will be in the directory in which you are running the {\bf OSSolverService.} 

\end{itemize}



{\bf IMPORTANT:}  Please do NOT commit the changes to these config files. 


\item[5.] Test {\bf OSCommon}. Build the OSCommon library.  Build the {\bf OSCommon} library.  Do a {\bf make install}.   Then connect to {\bf apiExamples} directory, build and run the {\bf apiExample.}
\end{itemize}
